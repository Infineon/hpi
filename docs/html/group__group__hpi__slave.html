<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HPI Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HPI Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__hpi__slave.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">HPIS (HPI Slave)</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>The Host Processor Interface (HPI) library implements the HPI transport, protocol, register, and PD message handling. </p>
<p>It allow the host processor or EC to monitor the status of the USB PD ports, change configuration, perform firmware updates, and transparently interact with other USB PD devices connected.</p>
<p>HPI communicates over an I2C interface (supported clock frequencies are 1 MHz, 400 kHz, and 100 kHz) with an interrupt line using a GPIO.</p>
<p><b>Features:</b></p><ul>
<li>Firmware version identification</li>
<li>Firmware update capability</li>
<li>Reporting of Type-C and USB PD connection status</li>
<li>Interrupt-based event reporting when connection status changes</li>
<li>Control of USB PD power profiles</li>
</ul>
<h1><a class="anchor" id="section_hpis_general_description"></a>
General description</h1>
<p>Include cy_hpi_defines.h, cy_hpi.h to get access to all functions and other declarations in this library. See the <a class="el" href="group__group__hpi__slave.html#section_hpis_quick_start">Quick start guide</a> to start using the HPI Library.</p>
<p>See the <a class="el" href="index.html#section_toolchain">Supported software and tools</a> section for compatibility information.</p>
<p>See the <a class="el" href="index.html#section_changelog">Changelog</a> section for change history.</p>
<h1><a class="anchor" id="section_hpis_quick_start"></a>
Quick start guide</h1>
<p>HPI middleware is used in ModusToolbox(TM) based development environment. See the <a class="el" href="index.html#section_toolchain">Supported software and tools</a> section.</p>
<p>These steps describe the simplest method to enable the HPI interface in a ModusToolbox(TM) based application.</p>
<ol type="1">
<li>Create or open an application to add HPI functions.</li>
<li>Add the HPI middleware to your project. This quick start guide assumes that the environment is configured to use the MTB CAT2 Peripheral Driver Library (PDL) for development and the PDL is included in the project.<br />
 Add the PDStack and PDUtils middleware along with the PmgAppCommon middleware libraries if the Type-C and Power Delivery functionality is needed in the application.</li>
<li>Include cy_hpi.h to get access to all functions and other declarations in this library. <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;cy_hpi.h&quot;</span></div></div><!-- fragment --></li>
<li>Define the following data structures required by the HPI middleware:<ul>
<li>SCB I2C and interrupt GPIO configuration structure. <div class="fragment"><div class="line"><span class="comment">/* PD stack context structure for port-0 */</span></div><div class="line"><span class="keyword">static</span> cy_stc_pdstack_context_t pdStackPort0Ctx;</div><div class="line"></div><div class="line"><span class="comment">/* PD stack context structure for port-1 */</span></div><div class="line"><span class="keyword">static</span> cy_stc_pdstack_context_t pdStackPort1Ctx;</div><div class="line"></div><div class="line"><span class="comment">/* I2C and GPIO hardware configuration structure */</span></div><div class="line"><a class="code" href="structcy__stc__hpi__hw__config__t.html">cy_stc_hpi_hw_config_t</a> hpiHwConfig =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__hpi__hw__config__t.html#a59ed9b4ec93f2bf08e9a71cd21fc4590">scbBase</a> = SCB4,</div><div class="line">    .scbPort = GPIO_PRT5,</div><div class="line">    .slaveAddr = 0x08,</div><div class="line">    .ecIntPort = GPIO_PRT3,</div><div class="line">    .ecIntPin = 2</div><div class="line">};</div></div><!-- fragment --></li>
<li>HPI slave context parameters <div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="structcy__stc__hpi__context__t.html">cy_stc_hpi_context_t</a> hpiContext;</div></div><!-- fragment --></li>
<li>Register application callback functions <div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="structcy__stc__hpi__app__cbk__t.html">cy_stc_hpi_app_cbk_t</a> hpiAppCbk =</div><div class="line">{</div><div class="line">    .<a class="code" href="structcy__stc__hpi__app__cbk__t.html#a9bed7aff0f8988dad77136950c52e2bd">ec_intr_write</a> = hpi_ec_intr_write,</div><div class="line">    .sys_get_custom_info_addr = NULL,</div><div class="line"><span class="preprocessor">#if (CY_HPI_PD_ENABLE)</span></div><div class="line">    .hpi_is_event_enabled = NULL,</div><div class="line">    .app_disable_pd_port = NULL,</div><div class="line"><span class="preprocessor">#if (DFP_ALT_MODE_SUPP || UFP_ALT_MODE_SUPP)</span></div><div class="line">    .alt_mode_get_status = NULL,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (DFP_ALT_MODE_SUPP || UFP_ALT_MODE_SUPP) */</span><span class="preprocessor"></span></div><div class="line">    .app_update_sys_pwr_state = NULL,</div><div class="line"><span class="preprocessor">#if (CY_HPI_PD_CMD_ENABLE)</span></div><div class="line"><span class="preprocessor">#if (DFP_ALT_MODE_SUPP) || (UFP_ALT_MODE_SUPP)</span></div><div class="line">    .set_custom_svid = NULL,</div><div class="line">    .set_alt_mode_mask = NULL,</div><div class="line">    .app_vdm_layer_reset = NULL,</div><div class="line">    .eval_app_alt_mode_cmd = NULL,</div><div class="line">    .eval_app_alt_hw_cmd = NULL,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* ((DFP_ALT_MODE_SUPP) || (UFP_ALT_MODE_SUPP)) */</span><span class="preprocessor"></span></div><div class="line">    .set_custom_host_cap_control = NULL,</div><div class="line">    .app_set_custom_pid = NULL,</div><div class="line">    .i2cm_gen_i2c_tunnel_cmd = NULL,</div><div class="line">    .switch_vddd_supply = NULL,</div><div class="line"><span class="preprocessor">#if (CY_HPI_VDM_QUERY_SUPPORTED)</span></div><div class="line">    .vdm_get_disc_id_resp = NULL,</div><div class="line">    .vdm_get_disc_svid_resp = NULL,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CY_HPI_VDM_QUERY_SUPPORTED) */</span><span class="preprocessor"></span></div><div class="line">    .app_update_bc_src_support = NULL,</div><div class="line"><span class="preprocessor">#if (CY_HPI_VBUS_C_CTRL_ENABLE)</span></div><div class="line">    .psnk_set_vbus_cfet_on_ctrl = NULL,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CY_HPI_VBUS_C_CTRL_ENABLE) */</span><span class="preprocessor"></span></div><div class="line">    .hpi_vconn_enable = NULL,</div><div class="line">    .hpi_vconn_disable = NULL,</div><div class="line"><span class="preprocessor">#if (CY_HPI_RW_PD_RESP_MSG_DATA)</span></div><div class="line">    .hpi_rw_pd_resp_data = NULL,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CY_HPI_RW_PD_RESP_MSG_DATA) */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CY_HPI_PD_CMD_ENABLE) */</span><span class="preprocessor"></span></div><div class="line">    .vbus_get_live_current = vbus_get_live_current,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CY_HPI_PD_ENABLE) */</span><span class="preprocessor"></span></div><div class="line">    .set_bootloader_run_type = set_bootloader_run_type,</div><div class="line"><span class="preprocessor">#if (!CY_HPI_BOOT_ENABLE)</span></div><div class="line">    .hpi_boot_validate_fw = hpi_boot_validate_fw,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (!CY_HPI_BOOT_ENABLE) */</span><span class="preprocessor"></span></div><div class="line">    .hpi_boot_validate_fw_cmd = hpi_boot_validate_fw_cmd,</div><div class="line"><span class="preprocessor">#if (!CY_HPI_BOOT_ENABLE)</span></div><div class="line">    .hpi_sys_get_device_mode = hpi_sys_get_device_mode,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (!CY_HPI_BOOT_ENABLE)) */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#if (CY_HPI_FLASH_RW_ENABLE)</span></div><div class="line">    .hpi_flash_row_write = hpi_flash_row_write,</div><div class="line">    .hpi_flash_row_read = hpi_flash_row_read,</div><div class="line">    .hpi_flash_access_get_status = NULL,</div><div class="line">    .hpi_flash_enter_mode = hpi_flash_enter_mode,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CY_HPI_FLASH_RW_ENABLE) */</span><span class="preprocessor"></span></div><div class="line"><span class="preprocessor">#if (CCG_UCSI_ENABLE)</span></div><div class="line">    .ucsi_notify = NULL,</div><div class="line">    .ucsi_reg_space_write_handler = NULL,</div><div class="line">    .ucsi_handle_hpi_commands = NULL,</div><div class="line">    .hpi_update_ucsi_reg_space = NULL,</div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* (CCG_UCSI_ENABLE) */</span><span class="preprocessor"></span></div><div class="line">    .hpi_dev_wr_handler_ext = NULL,</div><div class="line">    .hpi_port_wr_handler_ext = NULL,</div><div class="line">};</div></div><!-- fragment --> The HPI library uses these callbacks registered by the application to perform the application-specific tasks such as flash read/write, interrupt GPIO control, VBus control, validate firmware image, and so on.</li>
</ul>
</li>
<li>Invoke the <a class="el" href="group__group__hpis__functions.html#gacaf5f00f4c685799ca2e9447be019d38">Cy_Hpi_PdEventHandler</a> function from the solution event handler. <div class="fragment"><div class="line">    <a class="code" href="group__group__hpis__functions.html#gacaf5f00f4c685799ca2e9447be019d38">Cy_Hpi_PdEventHandler</a>(&amp;hpiContext, 0, APP_EVT_CONNECT, NULL);</div></div><!-- fragment --></li>
<li>Invoke the <a class="el" href="group__group__hpis__functions.html#ga4a86e162e396db66b77d0655e7a5c3f1">Cy_Hpi_I2cInterruptHandler</a> function from the SCB I2C interrupt service function. <div class="fragment"><div class="line">    <a class="code" href="group__group__hpis__functions.html#ga4a86e162e396db66b77d0655e7a5c3f1">Cy_Hpi_I2cInterruptHandler</a>(&amp;hpiContext);</div></div><!-- fragment --></li>
<li>Initialize the HPI middleware. Configure and initialize the I2C SCB in slave mode, before calling this function. <div class="fragment"><div class="line">    <a class="code" href="group__group__hpis__functions.html#ga921c0707424017d52d40971c69d71882">Cy_Hpi_Init</a>(&amp;hpiContext,                       <span class="comment">/* Pointer to HPI slave context */</span></div><div class="line">                &amp;hpiHwConfig,                      <span class="comment">/* HPI hardware interface detail */</span></div><div class="line">                &amp;hpiAppCbk,                        <span class="comment">/* Application callbacks */</span></div><div class="line">                &amp;pdStackPort0Ctx,                  <span class="comment">/* Pointer to the Port-0 PdStack context */</span></div><div class="line">                &amp;pdStackPort1Ctx,                  <span class="comment">/* Pointer to the Port-1 PdStack context */</span></div><div class="line">                2                                  <span class="comment">/* Number of Type-C ports supported */</span></div><div class="line">            );</div></div><!-- fragment --></li>
<li>Initialize common features such as HPI version, application versions, flash locations, and device mode based on the application design and current status. <div class="fragment"><div class="line">    <span class="comment">/* Set HPI version register info. */</span></div><div class="line">    <a class="code" href="group__group__hpis__functions.html#ga953087286724d4f417b88b0c2bc76dc1">Cy_Hpi_SetHpiVersion</a> (&amp;hpiContext,              <span class="comment">/* Pointer to HPI slave context */</span></div><div class="line">                           0x12345678);             <span class="comment">/* HPI version register bit value */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Set HPI extended version register info. */</span></div><div class="line">    <a class="code" href="group__group__hpis__functions.html#ga1d34986131f01beaeff899da9142bec4">Cy_Hpi_SetHpiVersionExt</a>(&amp;hpiContext,            <span class="comment">/* Pointer to HPI slave context */</span></div><div class="line">                            0x12345678);            <span class="comment">/* HPI extended version register bit value */</span></div><div class="line"></div><div class="line">    <span class="comment">/* Set HPI mode register info. */</span></div><div class="line">    <a class="code" href="group__group__hpis__functions.html#ga1e86eb3a4435d7d1de3e7e60b620e45e">Cy_Hpi_SetModeRegs</a>(&amp;hpiContext,                 <span class="comment">/* Pointer to HPI slave context */</span></div><div class="line">                        0x00, </div><div class="line">                        0x00);     </div><div class="line">     </div><div class="line">    <span class="comment">/* Set Bootloader and Application version information. */</span></div><div class="line">    <a class="code" href="group__group__hpis__functions.html#ga0510020bfc877d88c3264a91f08273a0">Cy_Hpi_UpdateVersions</a>(&amp;hpiContext,              <span class="comment">/* Pointer to HPI slave context */</span></div><div class="line">                        (uint8_t *)0x000000E0,      <span class="comment">/* Bootloader FW version offset address */</span></div><div class="line">                        (uint8_t *)0x001000E0,      <span class="comment">/* App-1 FW version offset address */</span></div><div class="line">                        (uint8_t *)0x002000E0       <span class="comment">/* App-2 FW version offset address */</span></div><div class="line">                        );</div><div class="line"></div><div class="line">    <span class="comment">/* Set firmware location flash row number. */</span></div><div class="line">    <a class="code" href="group__group__hpis__functions.html#ga85ff98db72e86004f44488bfb20eec1c">Cy_Hpi_UpdateFwLocations</a>(&amp;hpiContext,           <span class="comment">/* Pointer to HPI slave context */</span></div><div class="line">                             (uint16_t)0x0100,      <span class="comment">/* App-1 start location flash row number */</span></div><div class="line">                             (uint16_t)0x0200);     <span class="comment">/* App-2 start location flash row number */</span></div></div><!-- fragment --></li>
<li>Call <a class="el" href="group__group__hpis__functions.html#ga0712c2c9ad5b5e924e373457dacfd519">Cy_Hpi_Task</a> from the main processing loop of the application to handle the command and data received from the HPI master device. <div class="fragment"><div class="line">    <a class="code" href="group__group__hpis__functions.html#ga0712c2c9ad5b5e924e373457dacfd519">Cy_Hpi_Task</a>(&amp;hpiContext);</div></div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="section_hpis_configuration_considerations"></a>
Configuration considerations</h1>
<h1><a class="anchor" id="section_hpis_miscellaneous"></a>
Limitations and restrictions</h1>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__hpis__macros"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__hpis__macros.html">Macros</a></td></tr>
<tr class="memdesc:group__group__hpis__macros"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the HPI macros. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__hpis__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__hpis__functions.html">Functions</a></td></tr>
<tr class="memdesc:group__group__hpis__functions"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the HPI function prototypes. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__hpis__data__structures"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__hpis__data__structures.html">Data structures</a></td></tr>
<tr class="memdesc:group__group__hpis__data__structures"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the data structures defined by the HPI. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__hpis__enums"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__hpis__enums.html">Enumerated types</a></td></tr>
<tr class="memdesc:group__group__hpis__enums"><td class="mdescLeft">&#160;</td><td class="mdescRight">This section describes the enumeration types defined by the HPI. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>HPI Library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
